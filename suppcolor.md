# Supplemental Color Topics for Programmers

[Peter Occil](mailto:poccil14@gmail.com)

<a id=Introduction></a>
## Introduction

This document presents supplemental topics about color.  They add to my article on [color topics for programmers](https://peteroupc.github.io/colorgen.html).

<a id=Contents></a>
## Contents

- [Introduction](#Introduction)
- [Contents](#Contents)
- [Notation and Definitions](#Notation_and_Definitions)
- [Overview of Color Vision](#Overview_of_Color_Vision)
    - [Defective and Animal Color Vision](#Defective_and_Animal_Color_Vision)
    - [Opponent Signals](#Opponent_Signals)
- [Kinds of Color Spaces](#Kinds_of_Color_Spaces)
- [Calculating the Mean Hue Angle](#Calculating_the_Mean_Hue_Angle)
- [Additional Color Formats](#Additional_Color_Formats)
- [Additional Color Models](#Additional_Color_Models)
    - [HSI](#HSI)
    - [Hunter L,a,b](#Hunter_L_a_b)
- [Terminal Graphics](#Terminal_Graphics)
- [Irrelevant Topics](#Irrelevant_Topics)
- [Notes](#Notes)
- [License](#License)

<a id=Notation_and_Definitions></a>
## Notation and Definitions

- The [**pseudocode conventions**](https://peteroupc.github.io/pseudocode.html) apply to this document.
- **CIE.** French initials for the International Commission on Illumination.
- **RGB.** Red-green-blue.

<a id=Overview_of_Color_Vision></a>
## Overview of Color Vision

Color is possible only if three things exist, namely&mdash;

- _light_,
- an _object_ receiving that light (a surface, for example), and
- an _observer_ viewing that object and interpreting the light received from it.

Because of this, color does not exist in light, in objects receiving light, in light sources, or even in the signals generated by the eyes when they see things.<sup>[(1)](#Note1)</sup>  In the Opticks, I. Newton said, "the Rays to speak properly are not coloured."

The three things that together make color possible &mdash; light, object, and observer &mdash; can be modeled by curves that span the _visible spectrum_ (the part of the electromagnetic spectrum in which the eye senses light), as described in the section "[Spectral Color Functions](https://peteroupc.github.io/colorgen.html#Spectral_Color_Functions)". Also, any change in the light, object, or observer can also change the color sensation.

The _retina_ (inner lining) of the human eye contains three kinds of _cones_ (L, M, and S<sup>[(2)](#Note2)</sup>), and the visual system senses color by the relative degree to which all three kinds of cones respond to light waves.  The cone responses can be described by three overlapping "curves" that peak at different wavelengths of the visible spectrum &mdash; where the M and L curves span the entire visible spectrum.  As a result, at least two of the three kinds of cones will respond to light, not just one by itself.

Because there are three kinds of cones, three numbers are enough to uniquely identify a color humans can see &mdash; which is why many color models are 3-dimensional, such as RGB or CIE XYZ.

<a id=Defective_and_Animal_Color_Vision></a>
### Defective and Animal Color Vision

[Defective color vision](http://eilv.cie.co.at/term/287), including so-called ["colorblindness"](https://en.wikipedia.org/wiki/Color_blindness), results from defects in one or more kinds of cones and affects a small portion of people, mostly males. Two forms of defective color vision, _protanopia_ and _deuteranopia_, result from defects in the L or M cones, respectively, so that for a person with either condition, color stimuli resulting in a similar response of the S and M or S and L cones, respectively (usually from magenta-red and green-cyan hues), are harder to distinguish.<sup>[(3)](#Note3)</sup>

Even among people with normal color vision, though, there is [wide variation](http://www.handprint.com/HP/WCL/color2.html#individualdiffs) in color vision among individuals &mdash; such that they are not guaranteed to agree on how to identify any particular color.

In addition to humans, many other animals possess color vision to a greater or lesser extent.  As an extreme example, the [mantis shrimp](https://en.wikipedia.org/wiki/Mantis_shrimp) has 16 different cone types, making its color vision considerably sharper than humans'.

<a id=Opponent_Signals></a>
### Opponent Signals

The human visual system compares the cone responses it receives and converts them to three kinds of signals, namely&mdash;

- a light-dark signal, which is roughly the sum of the three cone responses,
- a red/green _opponent signal_, which is roughly the M response minus the L response, and
- a blue/yellow _opponent signal_, which is roughly the sum of the M and L responses minus the S response.

It's these signals, and not the cone responses, that are passed to the brain.  The theory of opponent colors is largely due to E. Hering's work and was reconciled with the three-cone theory around the mid-20th century (for example, through work by Hurvich and Jameson).

<a id=Kinds_of_Color_Spaces></a>
## Kinds of Color Spaces

Color spaces can be categorized as any of the following:

- **Device-dependent** color spaces are based on how devices display or record color.  Such color spaces include&mdash;
    - **light-mixture color spaces**, based on mixtures of colored light sources (such as RGB, red-green-blue), and
    - **colorant-mixture color spaces**, based on mixtures of inks, dyes, or other colorants (such as CMYK, cyan-magenta-yellow-black).<sup>[(4)](#Note4)</sup>

    A color space defined in terms of a device-dependent color space is itself device-dependent.  Examples of this include HSL, HSV, and HWB, which transform an RGB color space to ease intuition.
- **Device-independent** color spaces are other than device dependent (including color spaces based on how humans perceive color).  These include XYZ color spaces as well as color spaces defined in terms of the XYZ color model, such as CIELAB and CIELUV.
- **Lightness-based** color spaces have three dimensions, one of which is a light-dark dimension and the other two of which are _chromaticity_ dimensions.  Examples include HSL, CIE _L\*C\*h_, CIE XYZ, and Y&prime;C<sub>_B_</sub>C<sub>_R_</sub>.  Of these color spaces:
    - **Opponent** color spaces are arranged in three axes: black/white, red/green, and blue/yellow.  Examples include CIELAB and Hunter L,a,b.<sup>[(5)](#Note5)</sup>
- **Hue-based** color spaces have three dimensions, one of which is hue.  Examples include HSL, HSV, and CIE _L\*C\*h_.

<a id=Calculating_the_Mean_Hue_Angle></a>
## Calculating the Mean Hue Angle

The `MeanAngle` method, as given in the pseudocode below, finds the average of one or more angles expressed in radians (which is important when averaging colors in hue-based color models such as HSL, HSV, and CIE _L\*C\*h_, which contain hue components that are angles).

    METHOD MeanAngle(angles)
        if size(angles)==0: return 0
        xm=0
        ym=0
        i=0
        while i < size(angles)
            c = cos(angles[i])
            s = sin(angles[i])
            i = i + 1
            xm = xm + (c - xm) / i
            ym = ym + (s - ym) / i
        end
        return atan2(ym, xm)
    END

<a id=Additional_Color_Formats></a>
## Additional Color Formats

The following color formats express RGB colors in [8/8/8 format](https://peteroupc.github.io/colorgen.html#RGB_Integer_Formats) as text strings:

- **Delphi** format: Consists of "$00" followed by six base-16 (hexadecimal) digits, two each for the blue, green, and red components, in that order.
- **Visual Basic** format: Consists of "&H" followed by six base-16 digits, two each for the blue, green, and red components, in that order.
- **C++** format: Consists of "0x00" followed by six base-16 digits, two each for the three RGB components.  If the format expresses a Windows `COLORREF` color, the three components are blue, green, and red, in that order.
- **PowerBuilder** format: Consists of the integer form of the 8/8/8 format color, packed red/green/blue, in that order from lowest to highest bits.

<a id=Additional_Color_Models></a>
## Additional Color Models

<a id=HSI></a>
### HSI

A color following the HSI color model consists of three components, in the following order:

- _Hue_ has the same general meaning as HSV hue, but is calculated differently.
- A component called "saturation" is 0 or greater and 1 or less.
- A component called "intensity", the average of the red, green, and blue components, is 0 or greater and 1 or less.

The conversions given below are independent of RGB color space, but should be done using [_linearized RGB_ colors](https://peteroupc.github.io/colorgen.html#Linearized_and_Companded_RGB).

    METHOD RgbToHsi(rgb)
        sum=rgb[0]+rgb[1]+rgb[2]
        if sum==0: return [0,0,0]
        r=rgb[0]*1.0/sum
        g=rgb[1]*1.0/sum
        b=rgb[2]*1.0/sum
        coshue=(2*r-g-b)/(2*sqrt((b-g)*(b-r)+(g-r)*(g-r)))
        hue=atan2(sqrt(1-coshue*coshue),coshue)
        if b>g: hue=2*pi-hue
        return [hue, 1-min(r,g,b)*3, sum/3.0]
    END METHOD

    METHOD HsiToRgb(hsi)
       h=hsi[0]
       if h < 0: h = pi * 2 - mod(-h, pi * 2)
       if h >= pi * 2: h = mod(h, pi * 2)
       deg120=2*pi/3
       hmod=mod(h, deg120)
       a=hsi[2]*(1-hsi[1])
       b=(hsi[1]*cos(hmod)/sin(hmod+pi/6)+1)*hsi[2]
       c=3*hsi[2]-a-b
       if h>=deg120 and h < deg120*2: return [a,b,c]
       if h>=deg120*2: return [c,a,b]
       return [b,c,a]
    END METHOD

<a id=Hunter_L_a_b></a>
### Hunter L,a,b

The conversion between XYZ and Hunter L,a,b colors is as given below.

    METHOD HunterLabFromXYZ(xyz, wpoint)
        x=xyz[0]/wpoint[0]
        y=xyz[1]/wpoint[1]
        z=xyz[2]/wpoint[2]
        l=100*sqrt(y)
        if l==0: return [0,0,0]
        a=(7*sqrt(102)*sqrt(wpoint[0]/y)*(x-wpoint[0]*y))/(4*wpoint[0])
        b=(77*sqrt(70)*sqrt(wpoint[2]/y)*(wpoint[2]*y-z))/(100*wpoint[2])
        return [l,a,b]
    END METHOD

    METHOD HunterLabToXYZ(lab, wpoint)
        y=lab[0]*lab[0]/10000.0
        if y==0: return [0,0,0]
        x=2*sqrt(102)*lab[1]*wpoint[0]/(357*sqrt(wpoint[0]/y))+wpoint[0]*y
        z=-10*sqrt(70)*lab[1]*wpoint[2]/(539*sqrt(wpoint[2]/y))+wpoint[2]*y
        return [x,y/wpoint[1],z]
    END METHOD

The `LabToHue`, `LabToChroma`, `LabHueDifference`,
`LabChromaHueDifference`, and
`LchToLab` methods from the [discussion on CIELAB colors](colorgen.html#CIELAB) work with
Hunter L, a, b colors analogously to CIELAB colors.

The difference in lightness, _a_, _b_, or chroma (_&Delta;L_, _&Delta;a_, _&Delta;b_, or _&Delta;C_, respectively), between two Hunter L, a, b colors is simply the difference between the corresponding value of the second Hunter L, a, b color and that of the first.

<a id=Terminal_Graphics></a>
## Terminal Graphics

Some command-line shells support coloring the background or foreground of text.  In shells that support ["ANSI" (American National Standards Institute) color codes](https://en.wikipedia.org/wiki/ANSI_escape_code) (generally in the category "select graphic rendition", or SGR), the sequence U+001B (escape character) followed by "[" followed by a semicolon-separated sequence of numbers (given below) followed by "m" is a graphic control sequence (see also Ecma-048, sec. 8.3.117):

- "0": Reset the foreground and background color and other graphic properties to default.  (U+001B followed by "[m" has the same effect.)
- "1": Set the following text in bold.
- "2": Use a slightly dimmer foreground color than usual.
- "3": Set the following text in italics.
- "4": Underline the following text.
- "7": Reverse the meaning of "foreground" and "background" in the following text.
- "8": Hide text while still taking up space.
- "21", "22", "23", "24", "27", "28": Turns off the feature mentioned earlier in "1", "2", "3", "4", "7", or "8", respectively.
- "3" followed by one of the _color numbers_ below: Dimmer foreground color.
- "4" followed by color number: Dimmer background color.
- "9" followed by color number: Brighter foreground color.
- "10" followed by color number: Brighter background color.

The _color number_ is one of the following: "0" (black), "1" (red), "2" (green), "3" (yellow), "4" (blue), "5" (magenta), "6" (cyan), or "7" (white).  Note that not all shells support all the SGR codes given here, and that the exact colors named by each color number can vary with the implementation.

<a id=Irrelevant_Topics></a>
## Irrelevant Topics

The following topics on color are rarely relevant to programmers:

- The psychology, symbolism, or "meaning" of colors, since they vary from culture to culture and can change over time, even within the same culture.
- Language differences in color lexicons, for the same reason.
- "Color forecasting", or predicting which colors will be in high demand, especially in the fashion and design realms.

<a id=Notes></a>
## Notes

<small><sup id=Note1>(1)</sup> It's not accurate to speak of "red light", "green light", "blue light", "white light", and so on.</small>

<small><sup id=Note2>(2)</sup> Standing for long, medium, and short wavelength, respectively.  It's not quite accurate to speak of "red", "green", and "blue" cones, respectively.</small>

<small><sup id=Note3>(3)</sup> For information on how defective color vision can be simulated, see "[Color Blindness Simulation Research](http://ixora.io/projects/colorblindness/color-blindness-simulation-research/)", by "Jim".</small>

<small><sup id=Note4>(4)</sup> The colors that such lights or colorants are based on can be called "primary colors"; it's only in the context of light-mixture, colorant-mixture, or opponent color spaces that "primary colors" are normally relevant to programming.  Note that some light-mixture color spaces, such as the [ACES2065-1 RGB color space](http://www.oscars.org/science-technology/sci-tech-projects/aces), include imaginary points for one or more "primary colors" in exchange for covering a range of colors not normally possible otherwise.  Moreover, in my opinion&mdash;
- "additive mixture" should not be used to mean light mixture, but rather to mean [_additive mixture of color stimuli_](http://eilv.cie.co.at/term/24), and
- "subtractive mixture" is an inferior term to colorant mixture.</small>

<small><sup id=Note5>(5)</sup> In the context of such color spaces, the colors red, green, blue, and yellow are often called the _unique hues_, and those colors, with or without white and black, can be called "primary colors".  Here, such "primary colors" serve more to anchor the location of a particular color in the color space than to "mix all colors" or represent specific light sources or colorants.</small>

<a id=License></a>
## License
This page is licensed under [Creative Commons Zero](https://creativecommons.org/publicdomain/zero/1.0/).
